# 作者信息

| 用户名 | 推特 | 真实名字 | 简介 |
|--------|---------|------|--------|
| Seek | seek_web3 | ShiJiang.Guo | DappLink and The Web3 创始人, 曾就职于 Mantle, Bybit, 昆仑万维, HBTC, 币信, ChainUp, 云控蜂核, Achain, Linkeye, Kcash, Biwork, 华夏银行,中信银行|

# 第五节：门限共享秘密与安全多方计算（MPC）

## 一.算法简介

- 秘密备份：门限共享秘密算法（Threshold Secret Sharing Algorithm），是一种用于将敏感信息（如密钥）安全分割的方法。最常见的实现是 Shamir’s Secret Sharing（SSS）算法。该算法由 Adi Shamir 于 1979 年提出，广泛应用于密码学、密钥托管、分布式系统等领域。

- 密钥托管中心：MPC（Multi-Party Computation）是一种密码协议，允许多个参与方在不暴露各自私有数据的前提下共同完成一次计算，并只输出计算结果。例如：多个节点分别掌握私钥的“碎片”，但整个网络可以共同对一笔交易签名，而任何单个节点都无法获取完整私钥。

## 二.算法原理

### 1.门限共享秘密算法

#### 1.1.基本原理

- **目的**：将一个秘密 \( S \) 拆分成 \( n \) 份子密钥，任意 \( k \) 份即可恢复出原始秘密 \( S \)，但少于 \( k \) 份无法得知任何信息。
- **参数**：
  - \( n \)：总份数
  - \( k \)：门限值（最小恢复份数）
  - \( S \)：原始秘密（转为整数处理）

#### 1.2.Shamir 门限共享算法原理

##### 1.2.1.数学基础

利用有限域上的多项式插值（拉格朗日插值）构造多项式：f(x) = a₀ + a₁·x + a₂·x² + ... + aₖ₋₁·x⁽ᵏ⁻¹⁾

- \( a₀ = S \)，即秘密值
- \( a₁, ..., aₖ₋₁ \)：随机生成的系数
- 生成 \( n \) 个份额：\( (x₁, f(x₁)), (x₂, f(x₂)), ..., (xₙ, f(xₙ)) \)

##### 1.2.2.分发秘密

每个参与者获得一对 \( (xᵢ, f(xᵢ)) \)，称为子密钥。

##### 1.2.3.恢复秘密

只要有任意 \( k \) 个不同的点，就可用拉格朗日插值公式还原出多项式 \( f(x) \)，进而恢复秘密：S = f(0)

#### 1.3.算法流程（文字说明）

##### 1.3.1.秘密生成阶段（Key Generation）

- 输入：秘密 \( S \)、门限 \( k \)、总份数 \( n \)
- 随机选取 \( k-1 \) 个系数 \( a₁ \sim aₖ₋₁ \)
- 构造多项式 \( f(x) \)
- 计算 \( n \) 个点 \( (xᵢ, f(xᵢ)) \)，分发出去

##### 1.3.2.恢复阶段（Secret Reconstruction）

- 收集任意 \( k \) 个份额 \( (xᵢ, yᵢ) \)
- 使用拉格朗日插值法恢复 \( f(x) \)
- 计算 \( S = f(0) \)

##### 1.2.4.示例（整数说明）

- 秘密：`S = 1234`
- 门限：`k = 3`
- 总份数：`n = 5`
- 构造多项式：f(x) = 1234 + 166·x + 94·x²

- 生成份额：
  - `f(1) = 1494`
  - `f(2) = 1942`
  - `f(3) = 2594`
  - ...

使用任意 3 个份额，如 `(1,1494), (2,1942), (3,2594)`，即可还原出 `S = 1234`


##### 1.2.5.优点与应用
- 优点
  - 安全性高：少于 \( k \) 个节点无法还原秘密
  - 去中心化：多个参与者共同控制
  - 抗故障：部分节点失效不影响恢复
- 应用场景
  - 密钥备份（如多地分存冷钱包）
  - 企业密钥托管系统
  - 多人投票授权系统（如 DAO）
  - 安全恢复机制设计

##### 1.2.6.六.扩展算法

| 算法类型 | 特点 |
|----------|------|
| **Shamir’s Secret Sharing** | 经典实现，广泛使用 |
| **Pedersen Secret Sharing** | 支持承诺和验证，可抵御伪造 |
| **Verifiable Secret Sharing (VSS)** | 支持份额验证，适合抗作弊环境 |
| **Ramp Secret Sharing** | 支持压缩和容错，节省存储空间 |

### 2.MPC 算法

#### 2.1.MPC 核心签名流程（以 GG18 为例）

##### 1. 分布式密钥生成（Keygen）

- 所有参与者共同运行协议，计算出一个共享公钥 `Q`
- 私钥 `d` 被分为多个子密钥 `d₁, d₂, ..., dₙ`
- 每个节点仅掌握自己的私钥片段，**私钥从未完整存在过**

##### 2. 协同签名（Sign）

对消息 `m` 进行签名的过程如下：

- 多轮交互，每一轮节点之间交换加密数据或中间值
- 每个节点参与签名计算中间项，最终聚合得到 `(r, s)`
- 输出标准 ECDSA 签名，可链上验证

#### 2.2.主流 MPC 协议对比

| 协议 | 特点 | Keygen 轮次 | Sign 轮次 | 安全模型 | 应用项目 |
|------|------|-------------|-----------|-----------|------------|
| GG18 | 高安全性 | 5 | 9 | Honest Majority | Zengo, Fireblocks |
| GG20 | 更高效率 | 5 | 7 | UC 安全模型 | ZenGoX |
| FROST | 基于 Schnorr，交互少 | 2 | 2 | 可验证签名 | BTC Taproot |
| DKG | 分布式密钥生成子协议 | - | - | 通用适配 | 多个配套方案 |

#### 2.3.架构示意图

```
+-----------+      +-----------+      +-----------+
| Node A    |<---->| Node B    |<---->| Node C    |
| Key Share |      | Key Share |      | Key Share |
+-----------+      +-----------+      +-----------+
      \                 |                 /
       \         多轮交互协作签名        /
        \               |              /
         \----------> 聚合签名 <-------/
                      (r, s)
```

#### 2.4.主流的开源库
- Zengo
  - 支持 ECDSA 和 EDDSA
  - 支持 GG18 和 GG20
- CoinBase kryptology
  - 支持 ECDSA 和 EDDSA
  - GG20 和 DKLS
- Binance tss-lib
  - 支持 ECDSA 和 EDDSA
    - 仅仅支持 GG18 
    - SwingBy Protocol fork tss-lib 支持 GG20
- Fireblocks
  - 支持 CMP 和 CGGMP
  - 仅仅支持 ECDSA
- AMIS
  - 支持 ECDSA 和 EDDSA
  - 支持 GG18, GG20, CCLST 和 CGGMP

## 三.门限共享秘密算法（SSS） vs 多方安全计算（MPC）对比

### 1.对比总览

| 项目 | 门限共享秘密算法（SSS） | 多方安全计算（MPC） |
|------|--------------------------|----------------------|
| 本质 | 将秘密拆分成若干份 | 分布式协同计算（私钥永不重构） |
| 密钥生成方式 | 本地生成完整密钥后拆分 | 多方协作生成密钥 |
| 签名方式 | 重构完整密钥后签名 | 各方协作完成签名，无需恢复私钥 |
| 安全性 | 私钥在恢复时会暴露 | 私钥从未重构，安全性更高 |
| 交互过程 | 无需实时交互 | 多轮交互，通信复杂度高 |
| 实现复杂度 | 低，易实现 | 高，需密码协议与通信协议支持 |
| 可验证性 | 默认不可验证（可扩展为 VSS） | 多数协议内建验证机制 |
| 实时性 | 快速（恢复后立即可用） | 签名需时间（网络交互） |
| 存储方式 | 分发固定份额 | 每节点存储密钥片，需在线协作 |
| 典型协议 | Shamir、Pedersen、VSS | GG18、GG20、FROST、SPDZ |
| 应用场景 | 密钥备份、DAO、冷钱包 | 热钱包、MPC 钱包、交易所托管 |


### 2.适用场景推荐

| 需求场景 | 推荐方案 |
|----------|-----------|
| 多人持有密钥但需定期恢复 | Shamir Secret Sharing |
| 冷备份 + 高门限管理 | SSS + 硬件存储（如纸质/USB） |
| 热钱包签名，抗攻击 | MPC（GG18/GG20） |
| 私钥绝不落地，实时协同签名 | MPC |
| 快速 Schnorr 门限签名 | FROST |
| 高安全等级的机构级资产管理 | MPC + TEE/CloudHSM 组合方案 |


## 四.总结

| SSS 优势 | MPC 优势 |
|----------|-----------|
| 简单易实现，适合备份 | 高安全性，私钥永不重构 |
| 不需要网络交互 | 实时签名，适合线上服务 |
| 存储灵活（纸质/USB） | 自动化程度高，适合金融场景 |
| 适用于冷钱包、密钥恢复系统 | 广泛用于托管系统、MPC 钱包、DeFi 协议 |

